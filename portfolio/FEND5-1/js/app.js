var ballparks=[{title:"Angel Stadium of Anaheim",abbrev:"LAA",location:"Los Angeles",nickname:"Angels",lat:33.800326,lng:-117.882762,markerID:0},{title:"AT&T Park",abbrev:"SF",location:"San Francisco",nickname:"Giants",lat:37.778858,lng:-122.389248,markerID:1},{title:"Busch Stadium",abbrev:"STL",location:"St. Louis",nickname:"Cardinals",lat:38.622837,lng:-90.192799,markerID:2},{title:"Chase Field",abbrev:"ARI",location:"Arizona",nickname:"Diamondbacks",lat:33.445039,lng:-112.066732,markerID:3},{title:"Citi Field",abbrev:"NYM",location:"New York",nickname:"Mets",lat:40.757226,lng:-73.845824,markerID:4},{title:"Citizens Bank Park",abbrev:"PHI",location:"Philadelphia",nickname:"Phillies",lat:39.905569,lng:-75.166591,markerID:5},{title:"Comerica Park",abbrev:"DET",location:"Detroit",nickname:"Tigers",lat:42.33942,lng:-83.048942,markerID:6},{title:"Coors Field",abbrev:"COL",location:"Colorado",nickname:"Rockies",lat:39.755907,lng:-104.994173,markerID:7},{title:"Dodger Stadium",abbrev:"LAD",location:"Los Angeles",nickname:"Dodgers",lat:34.072974,lng:-118.240619,markerID:8},{title:"Fenway Park",abbrev:"BOS",location:"Boston",nickname:"Red Sox",lat:42.346859,lng:-71.097229,markerID:9},{title:"Great American Ball Park",abbrev:"CIN",location:"Cincinnati",nickname:"Reds",lat:39.097466,lng:-84.507029,markerID:10},{title:"Globe Life Park in Arlington",abbrev:"TEX",location:"Texas",nickname:"Rangers",lat:32.750289,lng:-97.081287,markerID:11},{title:"Kauffman Stadium",abbrev:"KC",location:"Kansas City",nickname:"Royals",lat:39.051839,lng:-94.480303,markerID:12},{title:"Marlins Park",abbrev:"MIA",location:"Miami",nickname:"Marlins",lat:25.778344,lng:-80.219723,markerID:13},{title:"Miller Park",abbrev:"MIL",location:"Milwaukee",nickname:"Brewers",lat:43.028213,lng:-87.971172,markerID:14},{title:"Minute Maid Park",abbrev:"HOU",location:"Houston",nickname:"Astros",lat:29.757413,lng:-95.355529,markerID:15},{title:"Nationals Park",abbrev:"WSH",location:"Washington",nickname:"Nationals",lat:38.873219,lng:-77.007411,markerID:16},{title:"O.co Coliseum",abbrev:"OAK",location:"Oakland",nickname:"Athletics",lat:37.751595,lng:-122.200528,markerID:17},{title:"Oriole Park at Camden Yards",abbrev:"BAL",location:"Baltimore",nickname:"Orioles",lat:39.283505,lng:-76.621911,markerID:18},{title:"Petco Park",abbrev:"SD",location:"San Diego",nickname:"Padres",lat:32.707582,lng:-117.156999,markerID:19},{title:"PNC Park",abbrev:"PIT",location:"Pittsburgh",nickname:"Pirates",lat:40.4470472,lng:-80.006175,markerID:20},{title:"Progressive Field",abbrev:"CLE",location:"Cleveland",nickname:"Indians",lat:41.495537,lng:-81.685278,markerID:21},{title:"Rogers Centre",abbrev:"TOR",location:"Toronto",nickname:"Blue Jays",lat:43.641453,lng:-79.389353,markerID:22},{title:"Safeco Field",abbrev:"SEA",location:"Seattle",nickname:"Mariners",lat:47.591653,lng:-122.332335,markerID:23},{title:"Target Field",abbrev:"MIN",location:"Minnesota",nickname:"Twins",lat:44.981911,lng:-93.27783,markerID:24},{title:"Tropicana Field",abbrev:"TB",location:"Tampa Bay",nickname:"Rays",lat:27.768485,lng:-82.653345,markerID:25},{title:"Turner Field",abbrev:"ATL",location:"Atlanta",nickname:"Braves",lat:33.735085,lng:-84.389973,markerID:26},{title:"U.S. Cellular Field",abbrev:"CWS",location:"Chicago",nickname:"White Sox",lat:41.830176,lng:-87.634225,markerID:27},{title:"Wrigley Field",abbrev:"CHC",location:"Chicago",nickname:"Cubs",lat:41.947902,lng:-87.655823,markerID:28},{title:"Yankee Stadium",abbrev:"NYY",location:"New York",nickname:"Yankees",lat:40.829848,lng:-73.926191,markerID:29}],mapView={defaultLat:39,defaultLng:-109,defaultZoom:3,windowWidth:void 0,markers:[],buildMap:function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:mapView.defaultLat,lng:mapView.defaultLng},zoom:mapView.defaultZoom}),infoWindow=new google.maps.InfoWindow;for(var e=0;e<ballparks.length;e++){var a="img/"+ballparks[e].abbrev+".png";mapView.markers[e]=new google.maps.Marker({map:map,icon:a,location:ballparks[e].location,nickname:ballparks[e].nickname,title:ballparks[e].title,lat:ballparks[e].lat,lng:ballparks[e].lng,position:new google.maps.LatLng(ballparks[e].lat,ballparks[e].lng),animation:google.maps.Animation.DROP}),google.maps.event.addListener(mapView.markers[e],"click",function(e){return function(){viewModel.getFlickrPics(e.title),viewModel.getWikipediaArticle(e.title),mapView.setBounce(e);var a='<div id="info-window-content"><p><strong>'+e.title+"</strong></p><p>Home of the "+e.location+" "+e.nickname;"Angels"===e.nickname&&(a+=" of Anaheim"),a+="</p><p><strong>Latitude: </strong>"+e.lat+"</p><p><strong>Longitude: </strong>"+e.lng+"</p></div>",mapView.initializeInfoWindow(e,a,infoWindow),infoWindow.open(map,e),viewModel.activeBallparkName(e.title),viewModel.searchVisible(!1),map.setZoom(15),mapView.getWindowWidth();var i=e.lng;mapView.windowWidth>609&&(i=e.lng-.005),map.setCenter(new google.maps.LatLng(e.lat,i))}}(mapView.markers[e]))}google.maps.event.addListener(infoWindow,"closeclick",function(){mapView.reset(),viewModel.reset()})},googleMapsFail:function(){alert("Sorry, there was an error loading Google Maps."),console.log("Error loading Google Maps")},init:function(){mapView.setMapDefaults()},getWindowWidth:function(){mapView.windowWidth=Math.max($(window).width(),$(window).innerWidth()||0)},openMarker:function(e){google.maps.event.trigger(mapView.markers[e],"click",{latLng:new google.maps.LatLng(0,0)})},setMapDefaults:function(){mapView.getWindowWidth(),mapView.windowWidth<610?mapView.defaultLng=-97:mapView.windowWidth<900?(mapView.defaultLng=-108-mapView.windowWidth/50,viewModel.infoVisible(!0)):(mapView.defaultZoom=4,viewModel.infoVisible(!0))},reset:function(){infoWindow.close(),mapView.setMapDefaults(),map.setCenter(new google.maps.LatLng(mapView.defaultLat,mapView.defaultLng)),map.setZoom(mapView.defaultZoom);for(var e=0;e<ballparks.length;e++)mapView.markers[e].setVisible(!0)},initializeInfoWindow:function(e,a,i){i.setContent(a)},setBounce:function(e){e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},700)}},viewModel={infoVisible:ko.observable(!1),searchVisible:ko.observable(!0),activeBallparkName:ko.observable(),activeBallparkMarkerID:ko.observable(),snippet:ko.observable(),flickrPics:ko.observable(),searchModeMessage:ko.observable("Advanced Search OFF"),advancedSearchMode:ko.observable(!1),regularSearchQuery:ko.observable(null),advancedSearchResult:ko.observable(),ballparkList:ko.observableArray(),observableBallparks:ko.observableArray(),init:function(){mapView.init(),viewModel.showAllBallparks(),viewModel.keyListener(),viewModel.buildBallparkObservables()},setActiveBallpark:function(e){viewModel.activeBallparkName(e.title),viewModel.activeBallparkMarkerID(e.markerID),mapView.openMarker(e.markerID)},showAllBallparks:function(){viewModel.ballparkList.removeAll();for(var e=0;e<ballparks.length;e++)viewModel.ballparkList.push(ballparks[e])},regularSearch:function(e){if(viewModel.ballparkList.removeAll(),""!==e)for(var a=0;a<ballparks.length;a++)viewModel.searchTermFound(e,a)?(viewModel.ballparkList.push(ballparks[a]),mapView.markers[a].setVisible(!0)):mapView.markers[a].setVisible(!1);else{viewModel.showAllBallparks();for(var a=0;a<mapView.markers.length;a++)mapView.markers[a].setVisible(!0)}},searchTermFound:function(e,a){return ballparks[a].title.toLowerCase().indexOf(e.toLowerCase())>=0?!0:!1},keyListener:function(){document.addEventListener("keyup",function(e){var a={27:"ESC"};viewModel.handleInput(a[e.keyCode])})},handleInput:function(e){switch(e){case"ESC":mapView.reset(),viewModel.reset()}},reset:function(){viewModel.searchVisible(!0),mapView.getWindowWidth(),mapView.windowWidth>=610&&viewModel.infoVisible(!0),viewModel.searchVisible(!0),viewModel.showAllBallparks(),viewModel.regularSearchQuery("")},getWikipediaArticle:function(e){var a=null;viewModel.snippet(""),a="Miller Park"===e?e+" Milwaukee":e;var i="https://en.wikipedia.org/w/api.php?action=query&callback=?&list=search&srsearch=";i+=encodeURIComponent(a)+"&srlimit=1&format=json",$.getJSON(i).done(function(e){var a=e.query.search[0].title;viewModel.snippet("<p>"+e.query.search[0].snippet+'  <a target="_blank" href="https://en.wikipedia.org/wiki/'+a+'">(Click for More)</a></p>')}).fail(function(e){alert("Sorry, there was an error getting an article from Wikipedia."),console.log("Error getting article from Wikipedia"),console.log(e)})},getFlickrPics:function(e){viewModel.flickrPics("");var a="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=fb90366ca9b7f830a002e1ff0924da2a&text=";a+="AT&T Park"===e?encodeURIComponent("ATT Park baseball"):encodeURIComponent(e+" baseball"),a+="&sort=relevance&media=photos&content_type=1&format=json&nojsoncallback=1&page=1&per_page=20",$.getJSON(a).done(function(e){for(var a="",i=0;20>i;i++){var l="https://www.flickr.com/photos/"+e.photos.photo[i].owner+"/"+e.photos.photo[i].id,r="https://farm"+e.photos.photo[i].farm+".staticflickr.com/"+e.photos.photo[i].server;r+="/"+e.photos.photo[i].id+"_"+e.photos.photo[i].secret+"_n.jpg";var o='<a target="_blank" href="'+l+'"><img src="'+r+'"></a>';a+=o}viewModel.flickrPics(a)}).fail(function(e){alert("Sorry, there was an error getting pictures from Flickr."),console.log("Error getting pictures from Flickr"),console.log(e)})},showInfo:function(){viewModel.infoVisible(!0)},hideInfo:function(){viewModel.infoVisible(!1)},Ballpark:function(e,a,i,l,r){this.title=ko.observable(e),this.location=ko.observable(a),this.nickname=ko.observable(i),this.abbrev=ko.observable(l),this.markerID=ko.observable(r),this.searchResultString=ko.computed(function(){var e=this.title()+" -- "+this.location()+" "+this.nickname();return"Angels"===this.nickname()&&(e+=" of Anaheim"),e+=" ("+this.abbrev()+")"},this)},buildBallparkObservables:function(){for(var e=0;e<ballparks.length;e++){var a=new viewModel.Ballpark(ballparks[e].title,ballparks[e].location,ballparks[e].nickname,ballparks[e].abbrev,ballparks[e].markerID);viewModel.observableBallparks.push(a)}}};viewModel.regularSearchQuery.subscribe(viewModel.regularSearch),viewModel.advancedSearchMode.subscribe(function(e){e===!0?viewModel.searchModeMessage("Advanced Search ON"):viewModel.searchModeMessage("Advanced Search OFF"),mapView.reset(),viewModel.reset()}),ko.bindingHandlers.advancedSearch={init:function(e,a,i){var l={};l.select=function(a,l){a.preventDefault(),i().selectedBallparkMarkerID(l.item.markerID),viewModel.ballparkList.removeAll();for(var r=0;r<ballparks.length;r++)i().selectedBallparkMarkerID()===ballparks[r].markerID?(viewModel.ballparkList.push(ballparks[r]),mapView.markers[r].setVisible(!0)):mapView.markers[r].setVisible(!1);$(e).val(null),mapView.openMarker(i().selectedBallparkMarkerID())};var r=ko.computed(function(){var e=ko.utils.arrayMap(ko.utils.unwrapObservable(viewModel.observableBallparks),function(e){var a={};return a.label=ko.utils.unwrapObservable(e[i().advancedSearchResult]),a.markerID=ko.utils.unwrapObservable(e.markerID),a});return e});l.source=r(),$(e).autocomplete(l)}},viewModel.init(),ko.applyBindings(viewModel);